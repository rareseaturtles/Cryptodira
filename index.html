<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cryptodira - Protecting Sea Turtles</title>
    <!-- Load the @solana/web3.js library -->
    <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.57.0/dist/index.iife.min.js"></script>
    <style>
        /* Add styles here */
    </style>
</head>
<body>
    <!-- Content and button for donations -->
    <button id="donateButton">Donate 0.005 SOL</button>

    <script>
        // Ensure that the solanaWeb3 library is defined
        if (typeof solanaWeb3 === 'undefined') {
            alert('Solana Web3 library is not loaded. Please check your code and try again.');
        } else {
            console.log('solanaWeb3 library loaded successfully.');
        }

        document.getElementById('donateButton').addEventListener('click', async function() {
            if (window.solana && window.solana.isPhantom) {
                try {
                    // Step 1: Connect to the wallet
                    await window.solana.connect();
                    console.log('Connected to Phantom Wallet:', window.solana.publicKey.toString());

                    // Step 2: Create a connection to the Solana blockchain
                    const connection = new solanaWeb3.Connection(solanaWeb3.clusterApiUrl('devnet'));

                    // Step 3: Get the user's public key
                    const userPublicKey = new solanaWeb3.PublicKey(window.solana.publicKey.toString());

                    // Step 4: Define the recipient's public key (your donation wallet)
                    const recipientAddress = new solanaWeb3.PublicKey('5kDS6zihkqZ76vLN4u9LCnvNU5cX1D2pcDw7ZMUfwTVG');

                    // Step 5: Specify the amount to send (in SOL)
                    const amountInSOL = 0.005;
                    const lamports = amountInSOL * solanaWeb3.LAMPORTS_PER_SOL; // Convert SOL to lamports

                    // Step 6: Create the transaction
                    const transaction = new solanaWeb3.Transaction().add(
                        solanaWeb3.SystemProgram.transfer({
                            fromPubkey: userPublicKey,
                            toPubkey: recipientAddress,
                            lamports: lamports,
                        })
                    );

                    // Step 7: Preview the transaction to the user for approval
                    alert(`A transaction of ${amountInSOL} SOL is ready to send to ${recipientAddress.toString()}. Please approve it in your wallet.`);

                    // Step 8: Sign and send the transaction
                    const signedTransaction = await window.solana.signAndSendTransaction(transaction);
                    console.log('Transaction sent:', signedTransaction);

                    // Step 9: Confirm the transaction
                    const transactionConfirmation = await connection.confirmTransaction(signedTransaction, 'confirmed');
                    if (transactionConfirmation) {
                        alert('Transaction successfully completed!');
                    }
                } catch (error) {
                    console.error('Error initiating the transaction:', error);
                    alert('An error occurred. Please try again.');
                }
            } else {
                alert('Phantom Wallet is not detected. Please install it and try again.');
            }
        });
    </script>
</body>
</html>

